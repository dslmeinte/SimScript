<!DOCTYPE html>
<html>
    <head>
        <title>jsPrototyping - calendar</title>
        <script src="js-type-system.js" type="text/javascript"></script>
        <script src="js/calendar.js" type="text/javascript"></script>
        <script src="js/calendar-temp-test-data.js" type="text/javascript"></script>
        <script src="js/ui-plugin/jquery.ui.core.js" type="text/javascript"></script>
        <script src="js/ui-plugin/jquery.ui.datepicker.js" type="text/javascript"></script>
        <link type="text/css" href="css/jquery-ui-1.8.20.custom.css" rel="stylesheet" />
        <link type="text/css" href="css/timelist.css" rel="stylesheet" />
    </head>
    <body>
        <script type="text/javascript">
            $(function(){
            	var table=$('<div style="display:table;">');
            	var cal=$('<div style="display:table-cell;">');
            	var list = $('<div style="display:table-cell;overflow:scroll;">')
            	table.append(cal).append(list);
                var d = $('<div>');
                d.datepicker({dateFormat:'dd-mm-yy'});
                var selectedSlot = $('<div>');
                cal.append(d).append(selectedSlot);
                var timelist = new TimeSlotList(list);
                d.datepicker('option', 'onSelect', function(dateText, inst){
                	// retrieve and format the date in API format
            		var format = $(this).datepicker('option', 'dateFormat');
            		var apiDateText = DateUtil.format($.datepicker.parseDate(format, dateText, inst.settings));
            		// TODO get the data for today form API
            		var data = API.getFreeSlots();
            		var slotsObject = data.filter(function(el){return el.day == apiDateText;})[0];

            		if (slotsObject && slotsObject.availableSlots) {
	            		timelist.loadSlots(slotsObject.availableSlots);
            		} else {
            			timelist.clearSlots();
            		}
                });
            	timelist.onSelect(function(start, end){
            		function p(a){return a<10?'0'+a:a;}
            		var a=d.datepicker('getDate');
            		var s=$.datepicker.formatDate(d.datepicker('option', 'dateFormat'), a);
            		s=s+' '+p(start.hours)+':'+p(start.minutes) + ' - ' + p(end.hours)+':'+p(end.minutes);
            		selectedSlot.html(s);
            	});
                $('body').html(table);
            });
        </script>
        <div id="myCoolCalendar"></div>
        <div id="myCoolListView"></div>
        <div id="myCoolDateListView"></div>
        <div id="myCoolClockGuy"></div>


        
    </body>
</html>